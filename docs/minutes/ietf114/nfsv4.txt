**Session Date/Time:** 26 Jul 2022 19:00

# nfsv4

## Summary

The nfsv4 working group meeting covered updates on several drafts, resulting in decisions to adopt some, let others expire, and defer significant discussions on the `bis` document and errata management. A key theme was the need to prioritize smaller, deployable documents while addressing the substantial maintenance work of the core NFSv4 protocol specifications. The working group expressed a desire to "finish what was started" and improve communication and clarity regarding its current work items.

## Key Discussion Points

*   **Agenda Bashing**
    *   Initial discussion about re-allocating time for the "roadmap of the working group" discussion, with presenters offering to shorten their slots.
    *   No formal changes to the agenda were made.
*   **NVMe Mapping for SCSI Layout (draft-ietf-nfsv4-nvme-scsi-layout)**
    *   **Background**: Draft updates RFC 8154 (block layout) to support NVMe, mapping NVMe concepts to SCSI. The latest version removes a problematic reference to a sloppily written NVMe-STLR document, replacing it with normative language.
    *   **Open Issues**:
        *   Whether to introduce new XDR code points for NVMe device designators (on-wire protocol change) or continue reusing existing SCSI types.
        *   Adding a new UUID designator type (RFC 4122) for device identification, applicable to both NVMe and SCSI.
    *   **Discussion**: Importance of NVMe for shared storage, existing Linux client/server implementation (20 lines on server, 2 versions on client for protocol changes or not). Chuck Lever proposed moving to WG document status as standards track. David Black and Richard Schaffranek agreed.
    *   **Decision**: The working group agreed to adopt `draft-ietf-nfsv4-nvme-scsi-layout` as a **standards track working group document**, with **no changes to the wire protocol**. The addition of a UUID designator will be deferred to a separate draft if deemed necessary later.
*   **RPC with TLS (draft-ietf-nfsv4-rpc-tls)**
    *   **Status**: The document is in `REF` (waiting on normative references). `RFC 9266` (KITTEN TLS13 channel bindings) was published during the session, removing a significant blocker.
    *   **Open Matters**:
        *   How `EXCHANGE_ID` and related operations could use TLS peer authentication (similar to Kerberos). No progress here.
        *   Mechanisms for servers to tell clients to use TLS for `OFS_` (Operations For Session) operations. The `rpc-tls-flavors` proposal received negative feedback.
    *   **Implementations**: FreeBSD (client/server), Daisy (user space), Hammerspace (client/server, not NFS), Linux client prototype, Nginx module (open source, front-end for standard NFS server).
    *   **Community Testing**: Interoperability testing has been successful.
    *   **Linux Client Prototype**: Uses an upcall mechanism for TLS handshake, adds a new mount option (`tls` or not).
    *   **Decision**: The working group agreed to **let `draft-lever-nfsv4-rpc-tls-flavors` expire**. Further discussion on how NFS servers can communicate security policy requirements via existing protocol elements will continue on the mailing list.
*   **RPC over RDMA v2 (draft-lever-nfsv4-rpc-rdma-v2)**
    *   **Flow Control**: Addressed in section 4.2.1 of the draft.
    *   **Security**: IESG concern about lack of security in RPC over RDMA. Discussion focused on building on existing sophisticated protocols like TLSv1.3 rather than custom mechanisms, and layering concerns (iWARP on Quick/TLS). David Black and Tom Talpey highlighted the complexity and hardware path considerations. Richard Schaffranek emphasized using industry-standard security protocols.
    *   **Read+ Challenges**: Difficulty fitting `READ_PLUS` into the RDMA paradigm for direct data placement due to unpredictable reply structures (content data vs. holes). Important for large sparse files. Christoph Hellwig suggested short reads could mitigate this.
    *   **Urgency & Resources**: Performance goals for v2 have largely been met by other work (PNFS layout, private data extension RFC 8797). Only one v2 prototype exists, limiting interoperability testing. The author noted limited resources available for this substantial work.
    *   **Decision**: The working group agreed to **let `draft-lever-nfsv4-rpc-rdma-v2` expire for now**, acknowledging that work could be reactivated later if resources and needs change. The related milestone will be removed.
*   **Delegation of State IDs / Open and Delegation Operations (draft-ietf-nfsv4-del-state-id)**
    *   **Status**: Draft published April 2018. Implementations exist (Hammerspace server, open-source client), but Linux kernel maintainers require IETF standards track for upstreaming.
    *   **Discussion**: Tom Talpey questioned the breadth of interest, given the document's idle state. No other implementers expressed interest during the meeting.
    *   **Decision**: The working group had **no objection to moving `draft-ietf-nfsv4-del-state-id` forward to Working Group Last Call**.
*   **Layouts Impeding File Recovery (draft-haynes-nfsv4-layout-recovery)**
    *   **Problem Statement**: During server reboot grace periods, clients reclaim open files. If a client encountered errors with a layout *before* the reboot, it currently lacks a mechanism to report these errors to the server because old state IDs are invalid. This is especially problematic for loosely coupled systems and client-side mirroring.
    *   **Proposed Solution**: Introduce new semantics for `LAYOUTRETURN` with a special state ID during the grace period, allowing clients to report pre-reboot errors. The server could then interpret this information if capable.
    *   **Discussion**: Tom Talpey and Chuck Lever suggested making this a *convention* rather than a normative protocol change, potentially a "simple note" or a non-protocol implementation detail.
    *   **Decision**: Tom Haynes will refine the proposal, focusing on a non-normative convention, and bring it to the mailing list for further discussion within two weeks.
*   **Working Group Roadmap and Future Work**
    *   **Overall State**: The working group has been "negligent in meeting deliverables" and has a backlog of "documentation work." There's concern about declining energy and slow progress on core documents.
    *   **`bis` Documents (e.g., `nfsv4-minor-versions`)**: Identified as the "biggest overhang." Dave Novak (who primarily owns this) was not present.
        *   **Definition**: A `bis` document replaces an older RFC, incorporating errata and clarifications, but doesn't necessarily imply major technical changes or a new protocol version.
        *   **Historical Context**: `bis` documents are often extensive, unloved, and require significant effort for minor gain. The previous NFSv4.0 `bis` took six years.
        *   **`nfsv4-minor-versions` specific context**: This document reportedly attempts to bring over internationalization changes from the NFSv4.0 `bis` and address errata. A previous proposal suggested splitting it into four sub-documents (e.g., security) to facilitate review by focused experts.
    *   **Errata Handling**: There are "huge amounts of unverified errata." Need to determine which are critical for current implementations versus obsolete.
    *   **Priorities**: Discussion centered on whether to focus on smaller, deployable documents (like NVMe layout) or the large `bis` documents.
    *   **New Work**: Sauron advocated for new work on data reduction (relevant to cloud deployments) to keep the WG current with industry trends. Brian Pulaski expressed reluctance for substantial new work, emphasizing "finish what we started."
    *   **Working Group Future**: The chairs clarified that there is no proposal to close the working group. The goal is to focus on priorities and resource allocation.
    *   **Charter Review**: Tom Talpey suggested reviewing the current WG charter to ensure it aligns with current priorities and future direction, especially if work is split into "large and small documents."

## Decisions and Action Items

1.  **Adopt `draft-ietf-nfsv4-nvme-scsi-layout`**: Move to Standards Track WG document, no wire protocol changes.
2.  **Expire `draft-lever-nfsv4-rpc-tls-flavors`**: Let the document expire.
3.  **Expire `draft-lever-nfsv4-rpc-rdma-v2`**: Let the document expire.
4.  **Move `draft-ietf-nfsv4-del-state-id` to WG Last Call**.
5.  **Refine Layout Recovery Proposal**: Tom Haynes to refine `draft-haynes-nfsv4-layout-recovery` focusing on a non-normative convention and bring it to the mailing list within two weeks.
6.  **WG Chairs to Communicate**: Write an email to the mailing list summarizing today's discussions, decisions, and action items.
7.  **`bis` Document Discussion Deferred**: Detailed discussion on `nfsv4-minor-versions` (the `bis` document) to be deferred until Dave Novak is present, including its purpose, WG adoption status, and the split strategy.
8.  **Scrub Errata List**: Christoph Hellwig (volunteered) to scrub the errata list, identify obsolete errata, and mark those already addressed in the `bis` document.
9.  **Charter Review**: Tom Talpey to review the current working group charter.

## Next Steps

*   The WG chairs will update the datatracker for `nfsv4-nvme-scsi-layout` and `nfsv4-del-state-id` (moving to WG document and WG Last Call respectively).
*   The WG chairs will communicate the outcomes of the RPC over RDMA v2 and RPC TLS Flavors document expirations.
*   Tom Haynes will prepare a revised proposal for layout recovery for mailing list discussion.
*   Christoph Hellwig will begin scrubbing the errata list.
*   Tom Talpey will review the working group charter.
*   A dedicated discussion on the `bis` document and its future (adoption as WG document, split strategy) will be scheduled when Dave Novak can attend.
*   The mailing list will be used for ongoing discussions on server security policy communication and layout recovery.